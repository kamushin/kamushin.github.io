<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Kamushin's blog</title><link href="/" rel="alternate"></link><link href="/feeds/kamushin.atom.xml" rel="self"></link><id>/</id><updated>2015-10-20T21:03:20+08:00</updated><entry><title>Pip 无网络环境安装包</title><link href="/tool/2015-10-20.html" rel="alternate"></link><updated>2015-10-20T21:03:20+08:00</updated><author><name>Kamushin</name></author><id>tag:,2015-10-20:tool/2015-10-20.html</id><summary type="html">&lt;p&gt;在内网部署 Python 的时候, 因为不能用连接到 &lt;code&gt;pip&lt;/code&gt; 源所以仅仅靠 requirement.txt 是不够的. 
我们需要 wheel 这个工具帮我们把需要的依赖先打成本地包. 
&lt;code&gt;pip wheel --wheel-dir=/tmp/wheelhouse tornado&lt;/code&gt;
这样 tornado 的依赖包就全在 wheelhouse 里了 
我们面对一个更悲剧的情况, 线上连 &lt;code&gt;pip&lt;/code&gt; 都没, 那么只能先在线下先给装好包.
&lt;code&gt;pip install --use-wheel --no-index --find-links=/tmp/wheelhouse -t  /tmp/wheelhouse/code tornado&lt;/code&gt;
这样包就全在 code 里了, 可以直接复制到线上. &lt;strong&gt;要注意编译环境一致和 so 库&lt;/strong&gt;&lt;/p&gt;</summary><category term="Python"></category></entry><entry><title>当我们在谈论异常时我们在谈论什么?</title><link href="/learning/2015-10-19-2.html" rel="alternate"></link><updated>2015-10-19T23:40:31+08:00</updated><author><name>Kamushin</name></author><id>tag:,2015-10-19:learning/2015-10-19-2.html</id><summary type="html">&lt;h3&gt;异常是什么&lt;/h3&gt;
&lt;p&gt;异常是一种用来分离程序运行中那1%会走进的&lt;strong&gt;岔路&lt;/strong&gt;的分支控制手段.&lt;/p&gt;
&lt;h3&gt;语言是如何实现它的&lt;/h3&gt;
&lt;p&gt;曾经, 大概在我大三末大四初的时候, 有幸读了本 C 接口与实现, 书里用 &lt;code&gt;setjump &amp;amp; longjmp&lt;/code&gt; 和宏的方式向我展现了如何在 C 语言中实现它.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Exception is a beautiful goto. &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;当然, sjlj 只是实现异常的一种, 还有基于 table 的方式等等, 更加高效, 在不进入异常时不产生副作用.&lt;/p&gt;</summary><category term="exception"></category></entry><entry><title>MySQL 优化学习之路</title><link href="/learning/2015-10-19.html" rel="alternate"></link><updated>2015-10-19T23:19:34+08:00</updated><author><name>Kamushin</name></author><id>tag:,2015-10-19:learning/2015-10-19.html</id><summary type="html">&lt;h3&gt;Overview&lt;/h3&gt;
&lt;h4&gt;DB Level&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;table structure: column data type | table with few or many columns&lt;/li&gt;
&lt;li&gt;right indexs&lt;/li&gt;
&lt;li&gt;storage engine&lt;/li&gt;
&lt;li&gt;data format: compression or not&lt;/li&gt;
&lt;li&gt;locking strategy&lt;/li&gt;
&lt;li&gt;caching size&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Hardware Level&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Disk seeks 10ms&lt;/li&gt;
&lt;li&gt;Disk reading and writing. easier to optimize than disk seeks&lt;/li&gt;
&lt;li&gt;CPU cycles large tables compared to the amount of memory ???&lt;/li&gt;
&lt;li&gt;Memory bandwith when CPU needs more data to fit in CPU cache ???&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;SQL&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;use explain&lt;/li&gt;
&lt;li&gt;indexs&lt;/li&gt;
&lt;li&gt;avoid full table scan&lt;/li&gt;
&lt;li&gt;analyze table periodically&lt;/li&gt;
&lt;li&gt;read-only transactions 5.6.4+ // had read an article on ATA about this&lt;/li&gt;
&lt;li&gt;avoid transforming query hard to read, optimizer will do this&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;SELECT&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;cover index: In some cases, MySQL can read rows from the index without even consulting the data file. If all columns used from the index are numeric, only the index tree is used to resolve the query. // need numeric ? TODO&lt;/li&gt;
&lt;li&gt;range index&lt;ul&gt;
&lt;li&gt;MySQL does not support merging ranges， use union&lt;/li&gt;
&lt;li&gt;&lt;code&gt;eq_range_index_dive_limit&lt;/code&gt; To permit use of index dives for comparisons of up to N equality ranges, set &lt;code&gt;eq_range_index_dive_limit&lt;/code&gt; to N + 1&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;index extensions: add pk after each secondary index  5.6.9&lt;/li&gt;
&lt;li&gt;two kinds of filesort&lt;/li&gt;
&lt;li&gt;group by: loose index scan vs tight index scan, depends on distribution of column(cardinality).&lt;/li&gt;
&lt;/ul&gt;</summary><category term="MySQL"></category></entry><entry><title>把Capslock重定向为Ctrl</title><link href="/nix/Change_caplocks.html" rel="alternate"></link><updated>2015-10-19T23:16:22+08:00</updated><author><name>Kamushin</name></author><id>tag:,2015-10-19:nix/Change_caplocks.html</id><summary type="html">&lt;p&gt;Capslock这键平时没多大用，而Ctrl则用的非常多，所以把Capslock换成Ctrl也算是个比较常见的需求。&lt;/p&gt;
&lt;p&gt;以前我是把xmodmap里swap脚本小改一下，也算在Arch上能用。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;remove Lock = Caps_Lock
remove Control = Control_L
keysym Control_L = Control_L
keysym Caps_Lock = Control_L
add Lock = Caps_Lock
add Control = Control_L
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;最近换了deepin后，这脚本会让Capslock啥也不做。于是找了个更加合理的脚本&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;remove Lock = Caps_Lock
remove Control = Control_L
keysym Caps_Lock = Control_L
add Lock = Caps_Lock
add Control = Control_L
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;比较一下， 就是少了一行对Control的设置，我猜之前出错的原因是Control_L不能被绑到两个keysym上&lt;/p&gt;</summary><category term="Linux"></category></entry><entry><title>Mac上遇到了一个Chrome和Safari被劫持的问题</title><link href="/nix/Chrome_be_hijacked.html" rel="alternate"></link><updated>2015-10-19T21:37:24+08:00</updated><author><name>Kamushin</name></author><id>tag:,2015-10-19:nix/Chrome_be_hijacked.html</id><summary type="html">&lt;p&gt;大概是因为下载了恶意的软件, 导致Chrome和Safari打开各种网站都出现广告. 检查过DNS
也更改过DNS, 无效. 目前没找到原因, 只能将就这用FireFox和Chromium, 这俩货没被劫持&lt;/p&gt;</summary><category term="杂事"></category></entry><entry><title>Pelican上增加评论和自动删除文章的一些坑</title><link href="/nix/Pelican.html" rel="alternate"></link><updated>2015-10-19T21:37:24+08:00</updated><author><name>Kamushin</name></author><id>tag:,2015-10-19:nix/Pelican.html</id><summary type="html">&lt;h3&gt;增加评论功能&lt;/h3&gt;
&lt;p&gt;这个网上有很多描述，主要是去disqus注册下，然后设置下配置文件&lt;a href="http://querbalken.net/howto-setup-comments-with-disqus-in-pelican-en.html"&gt;example&lt;/a&gt;坑主要在于Pelican的默认主题是没有disqus的模板的，所以虽然看到了对disqus的请求，却看不到评论区。需要自己下个比较全的主题。&lt;/p&gt;
&lt;h3&gt;自动删除文件&lt;/h3&gt;
&lt;p&gt;在content里删除了md文件，重新&lt;code&gt;make html&lt;/code&gt;后在output中依然会看到那个md文件生成的html文件。&lt;/p&gt;
&lt;p&gt;一个方法是加入配置&lt;code&gt;DELETE_OUTPUT_DIRECTORY = True&lt;/code&gt;来每次清空output，但是这带来了两个问题:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;自动日期没了 目前无法解决&lt;/li&gt;
&lt;li&gt;版本控制没了，可以通过加入&lt;code&gt;OUTPUT_RETENTION = [".hg", ".git", ".bzr"]&lt;/code&gt;来解决&lt;/li&gt;
&lt;/ul&gt;</summary><category term="Pelican"></category></entry><entry><title>用正则来解决grep时行过长的问题</title><link href="/tool/fxg.html" rel="alternate"></link><updated>2015-10-19T21:37:24+08:00</updated><author><name>Kamushin</name></author><id>tag:,2015-10-19:tool/fxg.html</id><summary type="html">&lt;p&gt;之前自己写了个函数用来查找文件中匹配关键字的&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;fxg_old(){
    find . -type f -name $1 | xargs grep $2 
}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;但是今天在用的时候，发现如果匹配到的行过长的话，输出很难看，而且也不知道哪里匹配到了。&lt;/p&gt;
&lt;p&gt;所以就想能不能对行的长度做限制，但是grep里并没有这个参数选项。于是想到了用正则去控制匹配串。在so上找到了这样的代码&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt; fxg(){
    find . -type f -name $1 | xargs grep -oE &amp;quot;.{0,20}$2.{0,20}&amp;quot;
 }
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;-o 只输出匹配的部分。 如果只加这个选项，那么就输出N行的$2。&lt;/p&gt;
&lt;p&gt;-E 使用扩展的正则(有人提到用-P，Perl正则，但是在我这里出现错误)&lt;/p&gt;
&lt;p&gt;后面的正则表达式用来匹配前后20个字符。&lt;/p&gt;
&lt;p&gt;这样就满足了我的需求&lt;/p&gt;</summary><category term="Linux"></category></entry><entry><title>TCP自连接</title><link href="/learning/tcp-self-connect.html" rel="alternate"></link><updated>2015-10-19T21:37:24+08:00</updated><author><name>Kamushin</name></author><id>tag:,2015-10-19:learning/tcp-self-connect.html</id><summary type="html">&lt;p&gt;陈硕的第8节视频介绍了TCP自连接这个特性。&lt;/p&gt;
&lt;p&gt;程序代码类似于:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;for i in range(65536):
    try:
        sock = socket.create_connection((&amp;#39;localhost&amp;#39;, port))
        time.sleep(60*60)
    except:
        ...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这里主要是这样的一个逻辑:  &lt;/p&gt;
&lt;p&gt;首先在循环中每次尝试创建连接的时候，TCP会分配一个IP给客户端，这个IP不是每次都随机的而是会自增。在最多尝试了65536或更少次后，一定会恰好和我们输入的port参数重合(如果port没有被占用)，那么就产生了一个客户端连接到自己的现象。要避免这个现象，可以在网络库中进行判断。&lt;/p&gt;</summary><category term="网络编程"></category></entry><entry><title>开始学习陈硕的网络编程课程</title><link href="/learning/test.html" rel="alternate"></link><updated>2015-10-19T21:37:24+08:00</updated><author><name>Kamushin</name></author><id>tag:,2015-10-19:learning/test.html</id><summary type="html">&lt;p&gt;很久前就关注了陈硕的这门课，等着他结课后一次性看完，截止到现在他已经更新了40多节了，
就要结束了，所以开始刷这门课。&lt;/p&gt;</summary><category term="网络编程"></category></entry></feed>